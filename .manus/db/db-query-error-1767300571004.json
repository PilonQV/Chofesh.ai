{
  "query": "\nCREATE TABLE IF NOT EXISTS `user_api_keys` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `userId` int NOT NULL,\n  `provider` enum('openai','anthropic','google') NOT NULL,\n  `encryptedKey` text NOT NULL,\n  `keyHint` varchar(8),\n  `isActive` boolean NOT NULL DEFAULT true,\n  `lastUsed` timestamp,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `usage_records` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `userId` int NOT NULL,\n  `actionType` enum('chat','image_generation','document_chat') NOT NULL,\n  `model` varchar(64),\n  `inputTokens` int DEFAULT 0,\n  `outputTokens` int DEFAULT 0,\n  `totalTokens` int DEFAULT 0,\n  `estimatedCost` varchar(20),\n  `keySource` enum('platform','user') NOT NULL DEFAULT 'platform',\n  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `user_documents` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `userId` int NOT NULL,\n  `filename` varchar(255) NOT NULL,\n  `originalName` varchar(255) NOT NULL,\n  `mimeType` varchar(100) NOT NULL,\n  `fileSize` int NOT NULL,\n  `storageUrl` text NOT NULL,\n  `textContent` text,\n  `chunkCount` int DEFAULT 0,\n  `status` enum('processing','ready','error') NOT NULL DEFAULT 'processing',\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `document_chunks` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `documentId` int NOT NULL,\n  `userId` int NOT NULL,\n  `chunkIndex` int NOT NULL,\n  `content` text NOT NULL,\n  `embedding` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (`documentId`) REFERENCES `user_documents`(`id`),\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 48hnjcx4CHbyzt9.87573283f85b --database ffmn4BbJe88bt6JMq4xy2a --execute \nCREATE TABLE IF NOT EXISTS `user_api_keys` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `userId` int NOT NULL,\n  `provider` enum('openai','anthropic','google') NOT NULL,\n  `encryptedKey` text NOT NULL,\n  `keyHint` varchar(8),\n  `isActive` boolean NOT NULL DEFAULT true,\n  `lastUsed` timestamp,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `usage_records` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `userId` int NOT NULL,\n  `actionType` enum('chat','image_generation','document_chat') NOT NULL,\n  `model` varchar(64),\n  `inputTokens` int DEFAULT 0,\n  `outputTokens` int DEFAULT 0,\n  `totalTokens` int DEFAULT 0,\n  `estimatedCost` varchar(20),\n  `keySource` enum('platform','user') NOT NULL DEFAULT 'platform',\n  `timestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `user_documents` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `userId` int NOT NULL,\n  `filename` varchar(255) NOT NULL,\n  `originalName` varchar(255) NOT NULL,\n  `mimeType` varchar(100) NOT NULL,\n  `fileSize` int NOT NULL,\n  `storageUrl` text NOT NULL,\n  `textContent` text,\n  `chunkCount` int DEFAULT 0,\n  `status` enum('processing','ready','error') NOT NULL DEFAULT 'processing',\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `document_chunks` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `documentId` int NOT NULL,\n  `userId` int NOT NULL,\n  `chunkIndex` int NOT NULL,\n  `content` text NOT NULL,\n  `embedding` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (`documentId`) REFERENCES `user_documents`(`id`),\n  FOREIGN KEY (`userId`) REFERENCES `users`(`id`)\n);\n",
  "returncode": 1,
  "logs": [
    "ERROR 1105 (HY000): No available TiDB instances, please make sure TiDB is available"
  ]
}